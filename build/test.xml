<?xml version="1.0"?>

<project name="Testing Testing Tools" basedir="." default="run-and-clean-up">
	<property name="lib.dir" value="../lib" />
	<property name="class-dir" value="../bin" />
	<property name="test-output-dir" value="../test-output" />

	<path id="classpath">
		<fileset dir="${lib.dir}" includes="**/*.jar" />
		<pathelement path="${class-dir}" />
	</path>

	<fileset dir="../tests" id="html-test-files">
		<include name="**/*test**.html" />
	</fileset>

	<target name="create-tests">
		<fileset id="tests">
			<include />
		</fileset>
		<pathconvert pathsep=" " property="testfiles" refid="html-test-files" />

		<java classname="com.itmill.testingtools.TestConverter" classpathref="classpath">
			<arg value="${test-output-dir}" />
			<arg line="${testfiles}" />
		</java>
	</target>

	<target name="compile-tests" depends="create-tests">
		<javac srcdir="${test-output-dir}" destdir="${class-dir}" debug="on">
			<classpath>
				<path refid="classpath" />
			</classpath>
		</javac>
	</target>


	<target name="run-tests" depends="run-firefox-tests,run-ie-tests">
	</target>

	<target name="run-firefox-tests" depends="compile-tests">
		<junit fork="yes">
			<classpath>
				<path refid="classpath" />
			</classpath>
			<jvmarg value="-Dtestingtools.tester.host=192.168.1.122" />
			<jvmarg value="-Dtestingtools.deployment.url=http://192.168.1.235:8080/" />
			<jvmarg value="-Dtestingtools.tester.browser=*chrome" />

			<batchtest>
				<fileset dir="${test-output-dir}">
					<include name="**/**.java" />
				</fileset>
			</batchtest>
		</junit>

	</target>

	<target name="run-ie-tests" depends="compile-tests">
		<junit fork="yes">
			<classpath>
				<path refid="classpath" />
			</classpath>
			<jvmarg value="-Dtestingtools.tester.host=192.168.1.122" />
			<jvmarg value="-Dtestingtools.deployment.url=http://192.168.1.235:8080/" />
			<jvmarg value="-Dtestingtools.tester.browser=*iexplore" />

			<batchtest>
				<fileset dir="${test-output-dir}">
					<include name="**/**.java" />
				</fileset>
			</batchtest>
		</junit>

	</target>
	<target name="remove-temp-files">
		<!-- test java files -->
		<delete>
			<fileset dir="${test-output-dir}">
				<include name="**/**.java" />
			</fileset>
		</delete>
	</target>

	<target name="run-and-clean-up" depends="run-tests,remove-temp-files">
	</target>
</project>
