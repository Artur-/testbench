<?xml version="1.0"?>

<project name="TestBench IDE extension" basedir="." default="extension">
	<tstamp />
	<!--<property name="version" value="${DSTAMP}${TSTAMP}" />-->

	<target name="testbench-recorder-package" depends="create-scripts">
		<!--<copy file="../selenium-extensions/vaadin-format.js" tofile="chrome/content/formats/vaadin-format.js"/>-->
		<jar jarfile="chrome/testbench-recorder.jar" compress="true">
			<manifest>
				<attribute name="Class-Path" value="" />
			</manifest>
			<fileset dir="chrome" excludes="testbench-recorder.jar">
			</fileset>
			<!--
			<fileset dir="../lib">
				<patternset>
					<exclude name="*-src.jar" />
					<exclude name="*-sources.jar" />
				</patternset>
			</fileset>
			-->
		</jar>
	</target>

	<target name="extension" depends="clean,testbench-recorder-package">
		<mkdir dir="extension" />
		<copy file="install.rdf_tpl" tofile="install.rdf" overwrite="true">
			<filterchain>
				<replacetokens>
					<token key="build" value="${version}" />
				</replacetokens>
			</filterchain>
		</copy>
		<zip destfile="extension/vaadin-testbench-recorder-${version}.xpi">
			<fileset dir="." includes="chrome/testbench-recorder.jar" />
			<fileset dir="." includes="components/**/**" />
			<fileset dir="." includes="content-files/**/**" />
			<fileset dir="." includes="chrome.manifest"/>
			<fileset dir="." includes="install.rdf"/>
		</zip>
	</target>

	<target name="clean">
		<delete failonerror="false" includeEmptyDirs="true">
			<fileset dir="extension"/>
		</delete>
	</target>
	
	<target name="create-scripts">
		<loadfile property="dofunction" srcFile="../selenium-extensions/core/doFunction.js">
			<filterchain>
				<replacetokens>
					<token key="triggerkey" value="triggerSpecialKeyEvent" />
				</replacetokens>
			</filterchain>
		</loadfile>
		<copy file="selenium-api.js_tpl" tofile="chrome/content/selenium/scripts/selenium-api.js" overwrite="true">
			<filterchain>
				<replacetokens>
					<token key="doFunction" value="${dofunction}" />
				</replacetokens>
			</filterchain>
		</copy>
		<loadfile property="locator" srcFile="../selenium-extensions/core/locator.js">
			<filterchain>
				<replacetokens>
					<token key="bot" value="BrowserBot" />
				</replacetokens>
			</filterchain>
		</loadfile>
		<copy file="selenium-browserbot.js_tpl" tofile="chrome/content/selenium/scripts/selenium-browserbot.js" overwrite="true">
			<filterchain>
				<replacetokens>
					<token key="locator" value="${locator}" />
				</replacetokens>
			</filterchain>
		</copy>
	</target>
	
</project>
