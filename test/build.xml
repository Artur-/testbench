<?xml version="1.0"?>

<project name="TestBench build tests" basedir="." default="all-tests">
	
	<property name="class.path" value="${java.class.path}" />
	
	<path id="classpath">
		<fileset dir="../lib" includes="**/*.jar"/>
	</path>
	
	<target name="compile-tests">
		<mkdir dir="test/classes" />
		<javac srcdir="../src/com/vaadin/testbench/test" destdir="test/classes">
			<classpath>
				<fileset dir="../build/result/package" includes="Vaadin-TestBench-*.jar" />
				<fileset dir="../lib" id="libs">
					<include name="*.jar" />
				</fileset>
			</classpath>
		</javac>
	</target>
	
	<target name="run-tests">
		<junit>
			<classpath>
				<pathelement path="../src/" />
				<fileset dir="../build/result/package" includes="Vaadin-TestBench-*.jar" />
				<path path="${class.path}" />
				<pathelement path="test/classes" />
			</classpath>

			<formatter type="plain" usefile="false" />
			
			<jvmarg value="-Dcom.vaadin.testbench.build=test/build" />
			<jvmarg value="-Duser.dir=${basedir}" />

			<batchtest fork="yes" haltonerror="yes" haltonfailure="yes">
				<fileset dir="../src">
					<include name="**/test/*.java" />
				</fileset>
			</batchtest>
		</junit>
	</target>
	
	<target name="clean">
		<delete dir="test/build" />
		<delete dir="test/classes" />
	</target>
	
	<target name="all-tests" depends="compile-tests, run-tests, clean"/>
	
</project>